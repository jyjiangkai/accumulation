//答辩记录

##logrotate原理
logrotate是我们拿来做日志备份的工具。
/opt/hacs/log/corosync/*.log{
	missingok    ##屏蔽错误信息
	compress     ##通过gzip压缩转储以后的日志
	notifempty   ##如果是空文件，不转储
	rotate 10    ##日志文件删除之前转储的次数
	size=+20480k ##当日志文件达到20M时开始转储
	corytruncate ##用于还在打开的日志文件，把当前日志备份并截断
}

##crontab原理
crontab是Linux下用来周期性执行指定命令的一个守护进程，crontab是开机自启动的。我们hacs在crontab中添加了hacs_ring_mon脚本，用于监控双机的心跳。

##HACS原理
资源是一些软件或者硬件实体，例如网卡、卷组、文件系统、数据库或应用软件等。资源是集群管理的基本单元，HACS支持如下资源类型：
####普通资源
普通资源是HACS中最基础的资源类型，例如IP资源、DB资源、文件系统资源等。普通资源可以作为组资源、对等多实例资源或主备多实例资源的子资源，也可以单独存在。当单独存在时，普通资源同一时刻最多只能在一个节点上运行。
####组资源
组资源由一个或多个紧密关联的普通资源按照一定的顺序组成。例如VG资源、文件系统资源和应用资源等必须按照一定的顺序和依赖关系运行，就可以组建为一个组资源。组资源可以作为对等多实例资源或主备多实例资源的子资源，也可以单独存在。当单独存在时，组资源同一时刻最多是能在一个节点上运行。
####对等多实例资源
对等多实例资源是在普通资源或组资源上增加同时在多个节点运行的特性。对等多实例资源必须包含且最多包含一个普通资源或一个组资源，例如状态检查资源等。对等多实例资源可以同时在多个节点上运行，且在不同的节点上运行的状态相同。
####主备多实例资源
主备多实例资源必须包含且最多包含一个普通资源或一个组资源。主备多实例资源可以同时在多个节点上运行，在不同的节点上运行的状态不同(区分主用状态或备用状态)。

###HACS提供三种资源约束关系，结合资源类型灵活配置，可以满足不同组网和集群管理方案的要求。
####资源位置约束关系
定义资源在那些节点上运行。例如，定义普通资源A可以在集群中的Node1和Node2节点上运行，但是同一时刻只能在一个节点上运行；定义多实例资源在集群中制定的几个节点上运行等。
如果不定义资源位置约束关系，则资源随机选择集群节点运行。
####资源顺序约束关系
定义资源间的操作顺序。例如，可以定义资源的启动顺序为：“res_VG->res_Filesystem->res_Application”，则资源按制定的顺序依次启动，反序停止。
如果不定义资源顺序约束关系，则资源并发启动或停止。
####资源组配约束关系
定义资源是否可以在相同的节点上运行。例如，定义资源DB和Application必须运行在同一个节点。

##云化容灾
云化容灾 数据备份与恢复
在一些大的公司，会使用SAN进行备份
灾难恢复有两个指标，一个是RPO(标识数据丢失率)，一个是RTO(恢复时间间隔的指标)。

关键词：
switchover：手工切换，生产机切换到容灾机
switchback：手动切换，容灾机切换到生产机
failover：故障切换，生产机切换到容灾机
failback：手动修复后，容灾机切换到生产机

RPO：灾难发生后系统丢失的数据量，以时间为单位，表示丢失了多少时间的数据量
RTP：灾难发生后到业务恢复正常所需的时间

数据基线：将生产子系统的数据全量复制到容灾子系统的过程。
反向基线：在从容灾子系统回切到生产子系统前，将容灾子系统的数据全量复制到生产子系统的过程。

####数据复制技术
生产局点和容灾局点之间的数据需要保持同步。数据同步最常见的方法按所用到的技术分为基于磁阵、逻辑卷、数据库、应用。
磁阵复制：基于磁阵的数据复制采用专用的存储设备，通过由存储设备截获磁盘I/O并复制到远端重做来复制数据。
卷复制：通过截获卷I/O复制到远端重做来复制数据。
数据库复制：将主数据库的日志或SQL复制到远程设备服务器，再将日志应用到备用数据库中实现数据库数据复制。其代表是Oracle Dataguard，Oracle GoldenGate。
应用复制：由应用将本地数据复制到远端，实现数据复制，数据可以是文件，也可以是内存中的记录。

数据复制可分为数据同步复制和异步复制两种模式。在同步模式中，数据在容灾节点和生产节点都写入才认为成功，在异步模式中，数据被写到生产节点就反馈成功，然后通过异步方式再写入到容灾节点。

####DataGuard
Oracle DataGuard是Oracle数据库提供的灾难恢复解决方案，该方案能够创建、维护以及管理一个或多个备用数据库，备用数据库复制了主数据库中的所有数据，当主数据库出现故障无法正常运行时，Oracle DataGuard能够启用任意一个物理备用，代替主数据库继续提供服务，避免或降低故障造成的损失。

####GoldenGate
GoldenGate是Oracle公司旗下一个支持多平台、多级别的数据同步解决方案。其基于日志的结构化数据复制方式，通过解析源数据库在线日志或归档日志获得数据的增删改变化，再将这些变化应用到目标数据库，实现源数据与目标数据库同步、双活。

####Filesync
Filesync是华为公司自研的一套低成本的数据复制方案。Filesync集成于GDR总体方案中，主要用于对变化频率较低的业务数据进行复制。由于是应用层复制，该方案对硬件，操作系统版本无特殊要求，能满足对异构数据复制的要求。

容灾演练：容灾演练是指模拟灾难发生时的处理流程，目的是为了验证容灾系统的可用性。

预启动：只启动容灾侧的应用、文件系统，验证容灾侧应用的可用性。
