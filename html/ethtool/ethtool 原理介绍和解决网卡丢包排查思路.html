<!DOCTYPE html>
<!-- saved from url=(0070)https://baijiahao.baidu.com/s?id=1671187032806091939&wfr=spider&for=pc -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="referrer" content="always"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><link rel="shortcut icon" href="https://gss0.bdstatic.com/5bd1bjqh_Q23odCf/static/wiseindex/img/favicon64.ico" type="image/x-icon"><link rel="apple-touch-icon-precomposed" href="https://gss0.bdstatic.com/5bd1bjqh_Q23odCf/static/wiseindex/img/screen_icon_new.png"><title>ethtool 原理介绍和解决网卡丢包排查思路</title><link rel="stylesheet" href="./ethtool 原理介绍和解决网卡丢包排查思路_files/land_min_pack_7b3c641.css"><meta itemprop="dateUpdate" content="2020-07-03 17:46:02"></head><body style=""><script>/* eslint-disable */var s_domain = {"protocol":"https:","staticUrl":"https://ss0.bdstatic.com/5aV1bjqh_Q23odCf/","base":"","baseuri":"","passconf":"http://passport.baidu.com/ubrwsbas","logout":"https://passport.baidu.com/?logout&u=","bs":"https://www.baidu.com","sp":"http://hi.baidu.com/","ssllist":{"a.hiphotos.baidu.com":"ss0.baidu.com/94o3dSag_xI4khGko9WTAnF6hhy","b.hiphotos.baidu.com":"ss1.baidu.com/9vo3dSag_xI4khGko9WTAnF6hhy","c.hiphotos.baidu.com":"ss3.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy","d.hiphotos.baidu.com":"ss0.baidu.com/-Po3dSag_xI4khGko9WTAnF6hhy","e.hiphotos.baidu.com":"ss1.baidu.com/-4o3dSag_xI4khGko9WTAnF6hhy","f.hiphotos.baidu.com":"ss2.baidu.com/-vo3dSag_xI4khGko9WTAnF6hhy","g.hiphotos.baidu.com":"ss3.baidu.com/-fo3dSag_xI4khGko9WTAnF6hhy","h.hiphotos.baidu.com":"ss0.baidu.com/7Po3dSag_xI4khGko9WTAnF6hhy","1.su.bdimg.com":"ss0.bdstatic.com/k4oZeXSm1A5BphGlnYG","t10.baidu.com":"ss0.baidu.com/6ONWsjip0QIZ8tyhnq","t11.baidu.com":"ss1.baidu.com/6ONXsjip0QIZ8tyhnq","t12.baidu.com":"ss2.baidu.com/6ONYsjip0QIZ8tyhnq","himg.bdimg.com":"ss1.bdstatic.com/7Ls0a8Sm1A5BphGlnYG","cdn00.baidu-img.cn":"ss0.bdstatic.com/9bA1vGba2gU2pMbfm9GUKT-w","cdn01.baidu-img.cn":"ss0.bdstatic.com/9bA1vGfa2gU2pMbfm9GUKT-w"}};var s_session = {"ssid":"0","logid":"","sid":"7550_32617_1462_7544_32327_7580_7552_7619_32115_32691","nid":"9628088870879822738","qid":""};var s_advert = {"isBjh":"1","contentUrl":"http://baijiahao.baidu.com/s?id=1671187032806091939","contentPlatformId":"3","contentType":"1","pvid":"a294f5157cd0c0f8","time":"2020-09-10 17:41:01","contentAccType":"1","ctk":"d5720c706620a894","contentAccId":"s5ZkXw0oyqzKRUMW_GJtuQ","ctk_b":"8741565c44b8889b","logid":"2461364764","dtime":"1599730861","grade":"2","createTimeAccLevel":"1"};</script><script>/* eslint-disable */var bds={se:{},su:{urdata:[],urSendClick:function(){},urStatic:"https://ss.bdimg.com"},util:{},use:{},comm:{domain:"",ubsurl:"",tn:"",queryEnc:"",queryId:"",inter:"",sugHost:"",query:"",qid:"",cid:"",sid:"",stoken:"",serverTime:"",user:"",username:"",loginAction:[],useFavo:"",pinyin:"",favoOn:"",curResultNum:"0",rightResultExist:false,protectNum:0,zxlNum:0,pageNum:1,pageSize:10,ishome:1,newindex:1}};var name,navigate,al_arr=[];var selfOpen=window.open;eval("var open = selfOpen;");var isIE=navigator.userAgent.indexOf("MSIE")!=-1&&!window.opera;var E=bds.ecom={};bds.se.mon={loadedItems:[],load:function(){},srvt:-1};try{bds.se.mon.srvt=parseInt(document.cookie.match(new RegExp("(^| )BDSVRTM=([^;]*)(;|$)"))[2]);document.cookie="BDSVRTM=;expires=Sat, 01 Jan 2000 00:00:00 GMT"}catch(e){}var bdUser=bds.comm.user?bds.comm.user:null,bdQuery=bds.comm.query,bdUseFavo=bds.comm.useFavo,bdFavoOn=bds.comm.favoOn,bdCid=bds.comm.cid,bdSid=bds.comm.sid,bdServerTime=bds.comm.serverTime,bdQid=bds.comm.queryId,bdstoken=bds.comm.stoken,login_success=[];</script><div id="detail-page"><div class="line-shadow"></div><div class="item-wrap"><div id="header_wrap" class="header_wrap"><div class="header_content"><div class="header_logo"><a href="https://www.baidu.com/" id="result_logo" data-clklog="tid:139;cst:2;logInfo:head_logo;" data-extralog="rid:;pos:;extra:;isBaiJiaHao:1;login:0;" data-rid="head_0"><img src="./ethtool 原理介绍和解决网卡丢包排查思路_files/logo_top.png" alt="到百度首页" title="到百度首页"></a></div><div class="header_menu" data-rid="header_menu"><a href="https://www.baidu.com/" class="index" data-clklog="tid:142;cst:2;logInfo:head_menu" data-extralog="rid:;pos:;extra:;isBaiJiaHao:1;login:0;type:backindex" data-rid="head_1">百度首页</a><span class="line"></span><div id="userBlock" class="unlogin" style="display: inline-block;"><a href="https://passport.baidu.com/v2/?login&amp;tpl=mn&amp;u=http://www.baidu.com" class="login" data-clklog="tid:142;cst:2;logInfo:head_menu;" data-extralog="rid:;pos:;extra:;isBaiJiaHao:1;login:0;type:login" data-rid="head_2">登录</a><a href="http://i.baidu.com/" id="usrname" class="usrname" data-clklog="tid:142;cst:2;logInfo:head_menu;" data-extralog="rid:;pos:;extra:;isBaiJiaHao:1;login:0;type:usrname;" data-rid="head_2"><span id="nametxt"></span></a><div id="user_menu" data-showlog="tid:131;cst:1;logInfo:usrmenu;" data-extralog="rid:;pos:;extra:;isBaiJiaHao:1;login:0;" class="s-isindex-wrap s-user-set-menu menu-top" style="display: none;"><a href="http://i.baidu.com/" id="usrname" class="usrname" data-clklog="tid:142;cst:2;logInfo:head_menu;" data-extralog="rid:;pos:;extra:;isBaiJiaHao:1;login:0;type:usrname;" data-rid="head_2"></a><div><a href="http://i.baidu.com/" id="usrname" class="usrname" data-clklog="tid:142;cst:2;logInfo:head_menu;" data-extralog="rid:;pos:;extra:;isBaiJiaHao:1;login:0;type:usrname;" data-rid="head_2"></a><a href="http://i.baidu.com/center" target="_blank" data-tid="1000" data-clklog="tid:146;cst:2;logInfo:usrmenu;" data-extralog="rid:;pos:1;extra:;isBaiJiaHao:1;login:0;type:center;" data-rid="usr_menu_1">个人中心</a><a href="http://passport.baidu.com/" data-tid="1001" target="_blank" data-clklog="tid:146;cst:2;logInfo:usrmenu;" data-extralog="rid:;pos:2;extra:;isBaiJiaHao:1;login:0;type:passport;" data-rid="usr_menu_2">帐号设置</a><a class="s-feedback" style="overflow:hidden" href="https://baijiahao.baidu.com/s?id=1671187032806091939&amp;wfr=spider&amp;for=pc#" onclick="return false;" data-clklog="tid:146;cst:2;logInfo:usrmenu;" data-extralog="rid:;pos:3;extra:;isBaiJiaHao:1;login:0;type:feedback;" data-rid="header_menu_3">意见反馈</a><a class="quit" style="overflow:hidden" href="https://passport.baidu.com/?logout&amp;u=https://www.baidu.com" data-clklog="tid:146;cst:2;logInfo:usrmenu;" data-extralog="rid:;pos:4;extra:;isBaiJiaHao:1;login:0;type:quit;" data-rid="usr_menu_4">退出</a></div><span class="menu-arrow"><em></em></span></div></div></div></div></div></div><div class="title_border"><div class="anci_header_content"><div class="article-title"><h2>ethtool 原理介绍和解决网卡丢包排查思路</h2></div><div class="article-desc clearfix"><div class="author-icon"><img src="./ethtool 原理介绍和解决网卡丢包排查思路_files/a7a8cb4094e4c31359e6088a449aad01.jpeg"></div><div class="author-txt"><p class="author-name">Linux运维堂</p><div class="article-source article-source-bjh"><span class="date">发布时间：07-03</span><span class="time">17:46</span><span class="account-authentication"></span></div></div></div></div></div><div id="content-container" class="content-container clearfix" data-showlog="tid:126;cst:1;logInfo:landing;" data-extralog="flow:2;st:news;rid:9628088870879822738;pos:0;extra:;source:1;isBaijiahao:1;login:0;appId:1671110774919486;" data-ratio="1" data-rid="page"><div id="left-container" class="left-container"><div class="item-wrap"><div class="article " id="article" data-islow-browser="0"><div class="article-content"><p><span class="bjh-blockquote"><span class="bjh-p">原文链接：https://wsgzao.github.io/post/ethtool/</span></span></p><p><span class="bjh-h3">老铁，请关注一波</span></p><div class="img-container"><img class="normal" width="500px" data-loadfunc="0" src="./ethtool 原理介绍和解决网卡丢包排查思路_files/4610b912c8fcc3cec0b8a70411a83f8ed53f2084.jpeg" data-loaded="0"></div><p><span class="bjh-h3">前言</span></p><p><span class="bjh-p">之前记录过处理因为 LVS 网卡流量负载过高导致软中断发生丢包的问题，RPS 和 RFS 网卡多队列性能调优实践[1]，对一般人来说压力不大的情况下其实碰见的概率并不高。这次想分享的话题是比较常见服务器网卡丢包现象排查思路，如果你是想了解点对点的丢包解决思路涉及面可能就比较广，不妨先参考之前的文章 如何使用 MTR 诊断网络问题[2]，对于 Linux 常用的网卡丢包分析工具自然是 ethtool。</span></p><p><span class="bjh-p">ethtool 用于查看和修改网络设备（尤其是有线以太网设备）的驱动参数和硬件设置。你可以根据需要更改以太网卡的参数，包括自动协商、速度、双工和局域网唤醒等参数。通过对以太网卡的配置，你的计算机可以通过网络有效地进行通信。该工具提供了许多关于接驳到你的 Linux 系统的以太网设备的信息。</span></p><p><span class="bjh-h3">1. 了解接收数据包的流程</span></p><p><span class="bjh-blockquote"><span class="bjh-p">这里摘取了美团技术团队的分析，在此表示感谢</span></span></p><p><span class="bjh-p">接收数据包是一个复杂的过程，涉及很多底层的技术细节，但大致需要以下几个步骤：</span></p><p><span class="bjh-ol"><span class="bjh-li"><span class="bjh-p">网卡收到数据包。</span></span><span class="bjh-li"><span class="bjh-p">将数据包从网卡硬件缓存转移到服务器内存中。</span></span><span class="bjh-li"><span class="bjh-p">通知内核处理。</span></span><span class="bjh-li"><span class="bjh-p">经过 TCP/IP 协议逐层处理。</span></span><span class="bjh-li"><span class="bjh-p">应用程序通过</span><span class="bjh-p">read()</span><span class="bjh-p">从</span><span class="bjh-p">socket buffer</span><span class="bjh-p">读取数据。</span></span></span></p><div class="img-container"><img class="normal" width="313px" data-loadfunc="0" src="./ethtool 原理介绍和解决网卡丢包排查思路_files/838ba61ea8d3fd1f4272d36fb3a3cc1994ca5f5b.jpeg" data-loaded="0"></div><p><span class="bjh-h3">将网卡收到的数据包转移到主机内存（NIC 与驱动交互）</span></p><p><span class="bjh-p">NIC 在接收到数据包之后，首先需要将数据同步到内核中，这中间的桥梁是</span></p><p><span class="bjh-p">rx ring buffer</span></p><p><span class="bjh-p">。它是由 NIC 和驱动程序共享的一片区域，事实上，</span></p><p><span class="bjh-p">rx ring buffer</span></p><p><span class="bjh-p">存储的并不是实际的 packet 数据，而是一个描述符，这个描述符指向了它真正的存储地址，具体流程如下：</span></p><p><span class="bjh-ol"><span class="bjh-li"><span class="bjh-p">驱动在内存中分配一片缓冲区用来接收数据包，叫做</span><span class="bjh-p">sk_buffer</span><span class="bjh-p">；</span></span><span class="bjh-li"><span class="bjh-p">将上述缓冲区的地址和大小（即接收描述符），加入到</span><span class="bjh-p">rx ring buffer</span><span class="bjh-p">。描述符中的缓冲区地址是 DMA 使用的物理地址；</span></span><span class="bjh-li"><span class="bjh-p">驱动通知网卡有一个新的描述符；</span></span><span class="bjh-li"><span class="bjh-p">网卡从</span><span class="bjh-p">rx ring buffer</span><span class="bjh-p">中取出描述符，从而获知缓冲区的地址和大小；</span></span><span class="bjh-li"><span class="bjh-p">网卡收到新的数据包；</span></span><span class="bjh-li"><span class="bjh-p">网卡将新数据包通过 DMA 直接写到</span><span class="bjh-p">sk_buffer</span><span class="bjh-p">中。</span><span class="bjh-p"><span class="bjh-br"></span></span></span></span></p><div class="img-container"><img class="large" data-loadfunc="0" src="./ethtool 原理介绍和解决网卡丢包排查思路_files/80cb39dbb6fd5266e480346729f57e2dd5073609.jpeg" data-loaded="0"></div><p><span class="bjh-p">当驱动处理速度跟不上网卡收包速度时，驱动来不及分配缓冲区，NIC 接收到的数据包无法及时写到</span></p><p><span class="bjh-p">sk_buffer</span></p><p><span class="bjh-p">，就会产生堆积，当 NIC 内部缓冲区写满后，就会丢弃部分数据，引起丢包。这部分丢包为</span></p><p><span class="bjh-p">rx_fifo_errors</span></p><p><span class="bjh-p">，在</span></p><p><span class="bjh-p">/proc/net/dev</span></p><p><span class="bjh-p">中体现为 fifo 字段增长，在 ifconfig 中体现为 overruns 指标增长。</span></p><p><span class="bjh-h3">通知系统内核处理（驱动与 Linux 内核交互）</span></p><p><span class="bjh-p">这个时候，数据包已经被转移到了</span></p><p><span class="bjh-p">sk_buffer</span></p><p><span class="bjh-p">中。前文提到，这是驱动程序在内存中分配的一片缓冲区，并且是通过 DMA 写入的，这种方式不依赖 CPU 直接将数据写到了内存中，意味着对内核来说，其实并不知道已经有新数据到了内存中。那么如何让内核知道有新数据进来了呢？答案就是中断，通过中断告诉内核有新数据进来了，并需要进行后续处理。</span></p><p><span class="bjh-p">提到中断，就涉及到硬中断和软中断，首先需要简单了解一下它们的区别：</span></p><p><span class="bjh-ul"><span class="bjh-li"><span class="bjh-p">硬中断：由硬件自己生成，具有随机性，硬中断被 CPU 接收后，触发执行中断处理程序。中断处理程序只会处理关键性的、短时间内可以处理完的工作，剩余耗时较长工作，会放到中断之后，由软中断来完成。硬中断也被称为上半部分。</span></span><span class="bjh-li"><span class="bjh-p">软中断：由硬中断对应的中断处理程序生成，往往是预先在代码里实现好的，不具有随机性。（除此之外，也有应用程序触发的软中断，与本文讨论的网卡收包无关。）也被称为下半部分。</span></span></span><span class="bjh-p"><span class="bjh-strong">当 NIC 把数据包通过 DMA 复制到内核缓冲区 </span></span></p><p><span class="bjh-p"><span class="bjh-strong">sk_buffer</span></span></p><p><span class="bjh-p"><span class="bjh-strong">后，NIC 立即发起一个硬件中断。CPU 接收后，首先进入上半部分，网卡中断对应的中断处理程序是网卡驱动程序的一部分，之后由它发起软中断，进入下半部分，开始消费</span></span></p><p><span class="bjh-p"><span class="bjh-strong">sk_buffer</span></span></p><p><span class="bjh-p"><span class="bjh-strong">中的数据，交给内核协议栈处理。</span></span></p><div class="img-container"><img class="large" data-loadfunc="0" src="./ethtool 原理介绍和解决网卡丢包排查思路_files/b812c8fcc3cec3fd34e200015e653d39859427de.jpeg" data-loaded="0"></div><p><span class="bjh-p">通过中断，能够快速及时地响应网卡数据请求，但如果数据量大，那么会产生大量中断请求，CPU 大部分时间都忙于处理中断，效率很低。为了解决这个问题，现在的内核及驱动都采用一种叫 NAPI（new API）的方式进行数据处理，其原理可以简单理解为 中断 + 轮询，在数据量大时，一次中断后通过轮询接收一定数量包再返回，避免产生多次中断。</span></p><p><span class="bjh-h3">2. ifconfig 解释</span></p><p><span class="bjh-p">[root@localhost ~]<span class="bjh-br"></span>eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500<span class="bjh-br"></span>inet 192.168.1.135 netmask 255.255.255.0 broadcast 192.168.1.255<span class="bjh-br"></span>inet6 fe80::20c:29ff:fe9b:52d3 prefixlen 64 scopeid 0x20&lt;link&gt;<span class="bjh-br"></span>ether 00:0c:29:9b:52:d3 txqueuelen 1000 (Ethernet)<span class="bjh-br"></span>RX packets 833 bytes 61846 (60.3 KiB)<span class="bjh-br"></span>RX errors 0 dropped 0 overruns 0 frame 0<span class="bjh-br"></span>TX packets 122 bytes 9028 (8.8 KiB)<span class="bjh-br"></span>TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0<span class="bjh-br"></span></span></p><p><span class="bjh-p">(1) RX errors</span></p><p><span class="bjh-p">表示总的收包的错误数量，这包括 too-long-frames 错误，Ring Buffer 溢出错误，crc 校验错误，帧同步错误，fifo overruns 以及 missed pkg 等等。</span></p><p><span class="bjh-p">(2) RX dropped</span></p><p><span class="bjh-p">表示数据包已经进入了 Ring Buffer，但是由于内存不够等系统原因，导致在拷贝到内存的过程中被丢弃。</span></p><p><span class="bjh-p">(3) RX overruns</span></p><p><span class="bjh-p">表示了 fifo 的 overruns，这是由于 Ring Buffer(aka Driver Queue) 传输的 IO 大于 kernel 能够处理的 IO 导致的，而 Ring Buffer 则是指在发起 IRQ 请求之前的那块 buffer。很明显，overruns 的增大意味着数据包没到 Ring Buffer 就被网卡物理层给丢弃了，而 CPU 无法即使的处理中断是造成 Ring Buffer 满的原因之一，上面那台有问题的机器就是因为 interruprs 分布的不均匀 (都压在 core0)，没有做 affinity 而造成的丢包。</span></p><p><span class="bjh-p">(4) RX frame</span></p><p><span class="bjh-p">表示 misaligned 的 frames。</span></p><p><span class="bjh-h3">3. 网卡工作原理</span></p><p><span class="bjh-blockquote"><span class="bjh-p">如果上面接收数据包的流程觉得不够详细可以再看纯文字解释</span></span></p><p><span class="bjh-h3">网卡收包</span></p><p><span class="bjh-p">网线上的 packet 首先被网卡获取，网卡会检查 packet 的 CRC 校验，保证完整性，然后将 packet 头去掉，得到 frame。网卡会检查 MAC 包内的目的 MAC 地址，如果和本网卡的 MAC 地址不一样则丢弃 (混杂模式除外)。</span></p><p><span class="bjh-p">网卡将 frame 拷贝到网卡内部的 FIFO 缓冲区，触发硬件中断。（如有 ring buffer 的网卡，好像 frame 可以先存在 ring buffer 里再触发软件中断（下篇文章将详细解释 Linux 中 frame 的走向），ring buffer 是网卡和驱动程序共享，是设备里的内存，但是对操作系统是可见的，因为看到 linux 内核源码里网卡驱动程序是使用 kcalloc 来分配的空间，所以 ring buffer 一般都有上限，另外这个 ring buffer size，表示的应该是能存储的 frame 的个数，而不是字节大小。另外有些系统的 ethtool 命令 并不能改变 ring parameters 来设置 ring buffer 的大小，暂时不知道为什么，可能是驱动不支持。）</span></p><p><span class="bjh-p">网卡驱动程序通过硬中断处理函数，构建 sk_buff，把 frame 从网卡 FIFO 拷贝到内存 skb 中，接下来交给内核处理。（支持 napi 的网卡应该是直接放在 ring buffer，不触发硬中断，直接使用软中断，拷贝 ring buffer 里的数据，直接输送给上层处理，每个网卡在一次软中断处理过程能处理 weight 个 frame）</span></p><p><span class="bjh-p">过程中，网卡芯片对 frame 进行了 MAC 过滤，以减小系统负荷。（除了混杂模式）</span></p><p><span class="bjh-h3">网卡发包</span></p><p><span class="bjh-p">网卡驱动程序将 IP 包添加 14 字节的 MAC 头，构成 frame（暂无 CRC）。Frame（暂无 CRC）中含有发送端和接收端的 MAC 地址，由于是驱动程序创建 MAC 头，所以可以随便输入地址，也可以进行主机伪装。</span></p><p><span class="bjh-p">驱动程序将 frame（暂无 CRC）拷贝到网卡芯片内部的缓冲区，由网卡处理。</span></p><p><span class="bjh-p">网卡芯片将未完全完成的 frame（缺 CRC）再次封装为可以发送的 packet，也就是添加头部同步信息和 CRC 校验，然后丢到网线上，就完成一个 IP 报的发送了，所有接到网线上的网卡都可以看到该 packet。</span></p><p><span class="bjh-h3">网卡中断处理函数</span></p><p><span class="bjh-p">产生中断的每个设备都有一个相应的中断处理程序，是设备驱动程序的一部分。每个网卡都有一个中断处理程序，用于通知网卡该中断已经被接收了，以及把网卡缓冲区的数据包拷贝到内存中。</span></p><p><span class="bjh-p">当网卡接收来自网络的数据包时，需要通知内核数据包到了。网卡立即发出中断。内核通过执行网卡已注册的中断处理函数来做出应答。中断处理程序开始执行，通知硬件，拷贝最新的网络数据包到内存，然后读取网卡更多的数据包。</span></p><p><span class="bjh-p">这些都是重要、紧迫而又与硬件相关的工作。内核通常需要快速的拷贝网络数据包到系统内存，因为网卡上接收网络数据包的缓存大小固定，而且相比系统内存也要小得多。所以上述拷贝动作一旦被延迟，必然造成网卡 FIFO 缓存溢出 - 进入的数据包占满了网卡的缓存，后续的包只能被丢弃，这也应该就是 ifconfig 里的 overrun 的来源。</span></p><p><span class="bjh-p">当网络数据包被拷贝到系统内存后，中断的任务算是完成了，这时它把控制权交还给被系统中断前运行的程序。</span></p><p><span class="bjh-h3">缓冲区访问</span></p><p><span class="bjh-p">网卡的内核缓冲区，是在 PC 内存中，由内核控制，而网卡会有 FIFO 缓冲区，或者 ring buffer，这应该将两者区分开。FIFO 比较小，里面有数据便会尽量将数据存在内核缓冲中。</span></p><p><span class="bjh-p">网卡中的缓冲区既不属于内核空间，也不属于用户空间。它属于硬件缓冲，允许网卡与操作系统之间有个缓冲；</span></p><p><span class="bjh-p">内核缓冲区在内核空间，在内存中，用于内核程序，做为读自或写往硬件的数据缓冲区；</span></p><p><span class="bjh-p">用户缓冲区在用户空间，在内存中，用于用户程序，做为读自或写往硬件的数据缓冲区；</span></p><p><span class="bjh-p">另外，为了加快数据的交互，可以将内核缓冲区映射到用户空间，这样，内核程序和用户程序就可以同时访问这一区间了。</span></p><p><span class="bjh-p">对于有 ring buffer 的网卡，ring buffer 是由驱动与网卡共享的，所以内核可以直接访问 ring buffer，一般拷贝 frames 的副本到自己的内核空间进行处理（deliver 到上层协议，之后的一个个 skb 就是按 skb 的指针传递方式传递，直到用户获得数据，所以，对于 ring buffer 网卡，大量拷贝发生在 frame 从 ring buffer 传递到内核控制的计算机内存里）。</span></p><p><span class="bjh-h3">4. 丢包排查思路</span></p><p><span class="bjh-p">网卡工作在数据链路层，数据量链路层，会做一些校验，封装成帧。我们可以查看校验是否出错，确定传输是否存在问题。然后从软件层面，是否因为缓冲区太小丢包。</span></p><p><span class="bjh-h3">先查看硬件情况</span></p><p><span class="bjh-p">一台机器经常收到丢包的报警，先看看最底层的有没有问题:</span></p><p><span class="bjh-p">(1) 查看工作模式是否正常</span></p><p><span class="bjh-p">[root@localhost ~]# ethtool eth0 | egrep 'Speed|Duplex'<span class="bjh-br"></span>Speed: 1000Mb/s<span class="bjh-br"></span>Duplex: Full<span class="bjh-br"></span></span></p><p><span class="bjh-p">(2) 查看检验是否正常</span></p><p><span class="bjh-p">[root@localhost ~]# ethtool -S eth0 | grep crc<span class="bjh-br"></span>rx_crc_errors: 0<span class="bjh-br"></span></span></p><p><span class="bjh-p">Speed，Duplex，CRC 之类的都没问题，基本可以排除物理层面的干扰。</span></p><p><span class="bjh-h3">overruns 和 buffer size</span></p><p><span class="bjh-p">for i in `seq 1 100`; do ifconfig eth2 | grep RX | grep overruns; sleep 1; done<span class="bjh-br"></span><span class="bjh-br"></span>RX packets:346547657 errors:0 dropped:0 overruns:35345 frame:0<span class="bjh-br"></span><span class="bjh-br"></span><span class="bjh-br"></span>-g   –show-ringQueries the specified ethernet device for rx/tx ring parameter information.<span class="bjh-br"></span>-G   –set-ringChanges the rx/tx ring parameters of the specified ethernet device.<span class="bjh-br"></span><span class="bjh-br"></span>ethtool -g eth0<span class="bjh-br"></span><span class="bjh-br"></span>[root@localhost ~]<span class="bjh-br"></span>Ring parameters for eth0:<span class="bjh-br"></span>Pre-set maximums:<span class="bjh-br"></span>RX: 4096<span class="bjh-br"></span>RX Mini: 0<span class="bjh-br"></span>RX Jumbo: 0<span class="bjh-br"></span>TX: 4096<span class="bjh-br"></span>Current hardware settings:<span class="bjh-br"></span>RX: 256<span class="bjh-br"></span>RX Mini: 0<span class="bjh-br"></span>RX Jumbo: 0<span class="bjh-br"></span>TX: 256<span class="bjh-br"></span><span class="bjh-br"></span><span class="bjh-br"></span>ethtool -G eth0 rx 2048<span class="bjh-br"></span>ethtool -G eth0 tx 2048<span class="bjh-br"></span><span class="bjh-br"></span>[root@localhost ~]<span class="bjh-br"></span>[root@localhost ~]<span class="bjh-br"></span>[root@localhost ~]<span class="bjh-br"></span>Ring parameters for eth0:<span class="bjh-br"></span>Pre-set maximums:<span class="bjh-br"></span>RX: 4096<span class="bjh-br"></span>RX Mini: 0<span class="bjh-br"></span>RX Jumbo: 0<span class="bjh-br"></span>TX: 4096<span class="bjh-br"></span>Current hardware settings:<span class="bjh-br"></span>RX: 2048<span class="bjh-br"></span>RX Mini: 0<span class="bjh-br"></span>RX Jumbo: 0<span class="bjh-br"></span>TX: 2048<span class="bjh-br"></span></span></p><p><span class="bjh-h3">Red Hat 官方解决思路</span></p><p><span class="bjh-blockquote"><span class="bjh-p">Issue</span></span></p><p><span class="bjh-p">Why</span></p><p><span class="bjh-p">rx_crc_errors</span></p><p><span class="bjh-p">incrementing in the receive counter of</span></p><p><span class="bjh-p">ethtool -S</span></p><p><span class="bjh-p">output?</span></p><p><span class="bjh-p">$ ethtool -S &lt;Interface_name&gt; | grep -i error<span class="bjh-br"></span>rx_error_bytes: 0<span class="bjh-br"></span>     tx_error_bytes: 0<span class="bjh-br"></span>     tx_mac_errors: 0<span class="bjh-br"></span>     tx_carrier_errors: 0<span class="bjh-br"></span>     rx_crc_errors: 9244<span class="bjh-br"></span>     rx_align_errors: 0<span class="bjh-br"></span></span></p><p><span class="bjh-blockquote"><span class="bjh-p">Resolution</span></span></p><p><span class="bjh-ol"><span class="bjh-li"><span class="bjh-p">Change the cable.</span></span><span class="bjh-li"><span class="bjh-p">Check switch configuration.</span></span><span class="bjh-li"><span class="bjh-p">Change the network interface card.</span></span></span><span class="bjh-blockquote"><span class="bjh-p">Root Cause</span></span></p><p><span class="bjh-ol"><span class="bjh-li"><span class="bjh-p">Most of the time incrementing the value of</span><span class="bjh-p">rx_crc_errors</span><span class="bjh-p">means the problem is in</span><span class="bjh-p">Layer-1</span><span class="bjh-p">of the networking model.</span></span><span class="bjh-li"><span class="bjh-p">When a packet is received at the interface, it goes through a data integrity check which is called</span><span class="bjh-p">cyclic redundancy check</span><span class="bjh-p">. If the packet fails in that check, it is marked as</span><span class="bjh-p">rx_crc_errors</span><span class="bjh-p">.</span></span><span class="bjh-li"><span class="bjh-p">The switch was forcing the</span><span class="bjh-p">NIC</span><span class="bjh-p">to operate in</span><span class="bjh-p">half-duplex</span><span class="bjh-p">mode. Fixing the switch to tell the</span><span class="bjh-p">NIC</span><span class="bjh-p">to operate in</span><span class="bjh-p">full-duplex</span><span class="bjh-p">mode have resolved the issue.</span></span></span><span class="bjh-blockquote"><span class="bjh-p">Diagnostic Steps</span></span></p><p><span class="bjh-p">Check</span></p><p><span class="bjh-p">ethtool -S</span></p><p><span class="bjh-p">output and find where are the drops and errors.</span></p><p><span class="bjh-p">$ ethtool -S &lt;Interface_name&gt; | grep -i error<span class="bjh-br"></span>rx_error_bytes: 0<span class="bjh-br"></span>     tx_error_bytes: 0<span class="bjh-br"></span>     tx_mac_errors: 0<span class="bjh-br"></span>     tx_carrier_errors: 0<span class="bjh-br"></span>     rx_crc_errors: 9244  &gt;&gt;&gt;&gt;&gt;&gt;<span class="bjh-br"></span>     rx_align_errors: 0<span class="bjh-br"></span></span></p><p><span class="bjh-p">Check the numbers corresponding to</span></p><p><span class="bjh-p">rx_crc_errors</span></p><p><span class="bjh-p">.</span></p><p><span class="bjh-p">ethtool p1p1<span class="bjh-br"></span><span class="bjh-br"></span>Settings for p1p1:<span class="bjh-br"></span>Supported ports: [ FIBRE ]<span class="bjh-br"></span> Supported link modes:   10000baseT/Full<span class="bjh-br"></span> Supported pause frame use: Symmetric<span class="bjh-br"></span> Supports auto-negotiation: No<span class="bjh-br"></span> Supported FEC modes: Not reported<span class="bjh-br"></span> Advertised link modes:  10000baseT/Full<span class="bjh-br"></span> Advertised pause frame use: Symmetric<span class="bjh-br"></span> Advertised auto-negotiation: No<span class="bjh-br"></span> Advertised FEC modes: Not reported<span class="bjh-br"></span> Speed: 10000Mb/s<span class="bjh-br"></span> Duplex: Full<span class="bjh-br"></span> Port: FIBRE<span class="bjh-br"></span> PHYAD: 0<span class="bjh-br"></span> Transceiver: internal<span class="bjh-br"></span> Auto-negotiation: off<span class="bjh-br"></span> Supports Wake-on: d<span class="bjh-br"></span> Wake-on: d<span class="bjh-br"></span> Current message level: 0x00000007 (7)<span class="bjh-br"></span>          drv probe link<span class="bjh-br"></span> Link detected: yes<span class="bjh-br"></span></span></p><p><span class="bjh-p">显示了 p1p1 的接口类型，连接模式，速率等等信息，以及当前是否连接了网线（如果是网线 Supported ports 就是 TP，如果是光纤则显示 Fiber），这里例举下 3 个重要关键词</span></p><p><span class="bjh-p">Supported ports: [FIBRE]<span class="bjh-br"></span>Speed: 10000Mb/s<span class="bjh-br"></span>Link detected: yes</span></p><p><span class="bjh-p">ethtool -S p1p1 | grep -i error<span class="bjh-br"></span>rx_errors: 0<span class="bjh-br"></span>     tx_errors: 0<span class="bjh-br"></span>     rx_over_errors: 0<span class="bjh-br"></span>     rx_crc_errors: 0<span class="bjh-br"></span>     rx_frame_errors: 0<span class="bjh-br"></span>     rx_fifo_errors: 0<span class="bjh-br"></span>     rx_missed_errors: 0<span class="bjh-br"></span>     tx_aborted_errors: 0<span class="bjh-br"></span>     tx_carrier_errors: 0<span class="bjh-br"></span>     tx_fifo_errors: 0<span class="bjh-br"></span>     tx_heartbeat_errors: 0<span class="bjh-br"></span>     rx_length_errors: 0<span class="bjh-br"></span>     rx_long_length_errors: 0<span class="bjh-br"></span>     rx_short_length_errors: 0<span class="bjh-br"></span>     rx_csum_offload_errors: 0<span class="bjh-br"></span><span class="bjh-br"></span><span class="bjh-br"></span><span class="bjh-br"></span>ethtool -p &lt;Interface_name&gt;<span class="bjh-br"></span>ethtool -p eth0<span class="bjh-br"></span><span class="bjh-br"></span><span class="bjh-br"></span>ethtool -i p1p1<span class="bjh-br"></span><span class="bjh-br"></span>driver: ixgbe<span class="bjh-br"></span>version: 5.1.0-k-rh7.6<span class="bjh-br"></span>firmware-version: 0x80000960, 18.3.6<span class="bjh-br"></span>expansion-rom-version:<span class="bjh-br"></span>bus-info: 0000:04:00.0<span class="bjh-br"></span>supports-statistics: yes<span class="bjh-br"></span>supports-test: yes<span class="bjh-br"></span>supports-eeprom-access: yes<span class="bjh-br"></span>supports-register-dump: yes<span class="bjh-br"></span>supports-priv-flags: yes<span class="bjh-br"></span><span class="bjh-br"></span><span class="bjh-br"></span><span class="bjh-br"></span>ethtool -s eth0 speed 100<span class="bjh-br"></span></span></p><p><span class="bjh-h3">参考文章</span></p><p><span class="bjh-p">ethtool[3]</span></p><p><span class="bjh-p">Counters Troubleshooting for Linux Driver[4]</span></p><p><span class="bjh-p">Why do I see rx_crc_errors in ethtool output?[5]</span></p><p><span class="bjh-p">ping 请求错误分析[6]</span></p><p><span class="bjh-p">ifconfig 命令详解[7]</span></p><p><span class="bjh-p">ethtool 命令详解[8]</span></p><p><span class="bjh-p">ethtool 解决网卡丢包严重和网卡原理[9]</span></p><p><span class="bjh-h3">脚注</span></p><p><span class="bjh-p">[1]</span></p><p><span class="bjh-p">RPS 和 RFS 网卡多队列性能调优实践: https://wsgzao.github.io/post/rps/</span></p><p><span class="bjh-p">[2]</span></p><p><span class="bjh-p">如何使用 MTR 诊断网络问题: https://wsgzao.github.io/post/mtr/</span></p><p><span class="bjh-p">[3]</span></p><p><span class="bjh-p">ethtool: https://mirrors.edge.kernel.org/pub/software/network/ethtool/</span></p><p><span class="bjh-p">[4]</span></p><p><span class="bjh-p">Counters Troubleshooting for Linux Driver: https://community.mellanox.com/s/article/counters-troubleshooting-for-linux-driver</span></p><p><span class="bjh-p">[5]</span></p><p><span class="bjh-p">Why do I see rx_crc_errors in ethtool output?: https://access.redhat.com/solutions/154543</span></p><p><span class="bjh-p">[6]</span></p><p><span class="bjh-p">ping 请求错误分析: https://blog.csdn.net/u011857683/article/details/83663316</span></p><p><span class="bjh-p">[7]</span></p><p><span class="bjh-p">ifconfig 命令详解: https://blog.csdn.net/u011857683/article/details/83758503</span></p><p><span class="bjh-p">[8]</span></p><p><span class="bjh-p">ethtool 命令详解: https://blog.csdn.net/u011857683/article/details/83758689</span></p><p><span class="bjh-p">[9]</span></p><p><span class="bjh-p">ethtool 解决网卡丢包严重和网卡原理: https://blog.csdn.net/u011857683/article/details/83758869</span></p></div><audio height="0" width="0" id="musicAudio" data-play-index=""><source></audio></div></div><button class="report-container" id="feedback_report(215939)">举报/反馈</button></div><div id="right-container" class="right-container"><div class="item-wrap"><div class="recent-article" data-pos=""><h2>作者最新文章<ul><li data-showlog="tid:135;cst:1;logInfo:recent_article;" data-extralog="rid:;pos:0;extra:;isBaiJiaHao:1;login:0;" data-rid="recent_article_0"><h3 class="item-title"><a href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9571170104495189277%22%7D&amp;n_type=1&amp;p_from=3" data-clklog="tid:147;cst:2;logInfo:recent_article;" data-extralog="rid:;pos:0;extra:;isBaiJiaHao:1;login:0;" target="_blank">Tomcat 又爆出高危漏洞！Tomcat 8.5~10 中招……</a></h3><div class="item-desc hide"><span class="info-date">07-03</span><span class="info-time">20:06</span></div></li><li data-showlog="tid:135;cst:1;logInfo:recent_article;" data-extralog="rid:;pos:1;extra:;isBaiJiaHao:1;login:0;" data-rid="recent_article_1"><h3 class="item-title"><a href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9628088870879822738%22%7D&amp;n_type=1&amp;p_from=3" data-clklog="tid:147;cst:2;logInfo:recent_article;" data-extralog="rid:;pos:1;extra:;isBaiJiaHao:1;login:0;" target="_blank">ethtool 原理介绍和解决网卡丢包排查思路</a></h3><div class="item-desc hide"><span class="info-date">07-03</span><span class="info-time">17:51</span></div></li></ul></h2></div></div><div class="item-wrap"><div class="related-news"><div class="news-content "><h2>相关文章</h2><ul><li data-showlog="tid:136;cst:1;logInfo:related_news;" data-extralog="flow:2;rid:;pos:0;extra:;isBaiJiaHao:1;login:0;" data-rid="related_news_0"><div class="item-content clearfix"><div class="news-info"><div class="news-title"><h3><a class="upgrade" data-clklog="tid:148;cst:2;logInfo:related_news;" data-extralog="rid:;pos:0;extra:;isBaiJiaHao:1;login:0;type:&#39;title&#39;" href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9921553485176393745%22%7D&amp;n_type=1&amp;p_from=4" target="_blank">保密会议信息是怎么被泄露的？</a></h3></div></div><div class="news-pic"><a class="upgrade" data-clklog="tid:148;cst:2;logInfo:related_news;" data-extralog="rid:;pos:1;extra:;isBaiJiaHao:1;login:0;type:&#39;img&#39;" href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9921553485176393745%22%7D&amp;n_type=1&amp;p_from=4" target="_blank"><img src="./ethtool 原理介绍和解决网卡丢包排查思路_files/u=931892139,677795461&amp;fm=173&amp;app=49&amp;f=JPEG"></a></div></div></li><li data-showlog="tid:136;cst:1;logInfo:related_news;" data-extralog="flow:2;rid:;pos:1;extra:;isBaiJiaHao:1;login:0;" data-rid="related_news_1"><div class="item-content clearfix"><div class="news-info"><div class="news-title"><h3><a class="upgrade" data-clklog="tid:148;cst:2;logInfo:related_news;" data-extralog="rid:;pos:1;extra:;isBaiJiaHao:1;login:0;type:&#39;title&#39;" href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9797298737009600533%22%7D&amp;n_type=1&amp;p_from=4" target="_blank">激光制造时使用视觉技术达到了一个新高度</a></h3></div></div><div class="news-pic"><a class="upgrade" data-clklog="tid:148;cst:2;logInfo:related_news;" data-extralog="rid:;pos:2;extra:;isBaiJiaHao:1;login:0;type:&#39;img&#39;" href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9797298737009600533%22%7D&amp;n_type=1&amp;p_from=4" target="_blank"><img src="./ethtool 原理介绍和解决网卡丢包排查思路_files/u=3556882821,2819090712&amp;fm=173&amp;app=49&amp;f=JPEG"></a></div></div></li><li data-showlog="tid:136;cst:1;logInfo:related_news;" data-extralog="flow:2;rid:;pos:2;extra:;isBaiJiaHao:1;login:0;" data-rid="related_news_2"><div class="item-content clearfix"><div class="news-info"><div class="news-title"><h3><a class="upgrade" data-clklog="tid:148;cst:2;logInfo:related_news;" data-extralog="rid:;pos:2;extra:;isBaiJiaHao:1;login:0;type:&#39;title&#39;" href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9729156460799816537%22%7D&amp;n_type=1&amp;p_from=4" target="_blank">Mac上的学习工具，有这10款就够了！</a></h3></div></div><div class="news-pic"><a class="upgrade" data-clklog="tid:148;cst:2;logInfo:related_news;" data-extralog="rid:;pos:3;extra:;isBaiJiaHao:1;login:0;type:&#39;img&#39;" href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9729156460799816537%22%7D&amp;n_type=1&amp;p_from=4" target="_blank"><img src="./ethtool 原理介绍和解决网卡丢包排查思路_files/u=181341218,2029192801&amp;fm=173&amp;app=49&amp;f=JPEG"></a></div></div></li><li data-showlog="tid:136;cst:1;logInfo:related_news;" data-extralog="flow:2;rid:;pos:3;extra:;isBaiJiaHao:1;login:0;" data-rid="related_news_3"><div class="item-content clearfix"><div class="news-info"><div class="news-title"><h3><a class="upgrade" data-clklog="tid:148;cst:2;logInfo:related_news;" data-extralog="rid:;pos:3;extra:;isBaiJiaHao:1;login:0;type:&#39;title&#39;" href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9696781890860059661%22%7D&amp;n_type=1&amp;p_from=4" target="_blank">DevOps平台之三方权限集成管理</a></h3></div></div><div class="news-pic"><a class="upgrade" data-clklog="tid:148;cst:2;logInfo:related_news;" data-extralog="rid:;pos:4;extra:;isBaiJiaHao:1;login:0;type:&#39;img&#39;" href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9696781890860059661%22%7D&amp;n_type=1&amp;p_from=4" target="_blank"><img src="./ethtool 原理介绍和解决网卡丢包排查思路_files/u=557998002,2492311410&amp;fm=173&amp;app=49&amp;f=JPEG"></a></div></div></li><li data-showlog="tid:136;cst:1;logInfo:related_news;" data-extralog="flow:2;rid:;pos:4;extra:;isBaiJiaHao:1;login:0;" data-rid="related_news_4"><div class="item-content clearfix"><div class="news-info"><div class="news-title"><h3><a class="upgrade" data-clklog="tid:148;cst:2;logInfo:related_news;" data-extralog="rid:;pos:4;extra:;isBaiJiaHao:1;login:0;type:&#39;title&#39;" href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9678060725403394553%22%7D&amp;n_type=1&amp;p_from=4" target="_blank">九款mac必装软件大放送~</a></h3></div></div><div class="news-pic"><a class="upgrade" data-clklog="tid:148;cst:2;logInfo:related_news;" data-extralog="rid:;pos:5;extra:;isBaiJiaHao:1;login:0;type:&#39;img&#39;" href="https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_9678060725403394553%22%7D&amp;n_type=1&amp;p_from=4" target="_blank"><img src="./ethtool 原理介绍和解决网卡丢包排查思路_files/u=2775894458,2947318786&amp;fm=173&amp;app=49&amp;f=JPEG"></a></div></div></li></ul></div></div><div id="relateAd" ad-id="relate-js" class="wangmeng-ad" data-showlog="tid:369;cst:1;logInfo:adsjs;" data-clklog="tid:370;cst:2;logInfo:adsjs;" data-extralog="rid:;pos:5;extra:;baijiahao:1;login:0;"></div></div></div></div><div id="bottom-container" class="bottom-container "><div class="copy-right"><div class="baidu-info"><a class="sethome" href="https://www.baidu.com/cache/sethelp/index.html" target="_blank"><span>设为首页</span></a><span class="copyright-text"><span>©&nbsp;Baidu&nbsp;</span><a href="https://www.baidu.com/duty/" target="_blank">使用百度前必读</a>&nbsp;<a href="http://jianyi.baidu.com/" target="_blank">意见反馈</a>&nbsp;<span>京ICP证030173号&nbsp;</span><img width="13" height="16" src="./ethtool 原理介绍和解决网卡丢包排查思路_files/copy_rignt_24.png"></span></div><div class="recordcode"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11000002000001" target="_blank"><i></i>京公网安备11000002000001号</a></div></div><div class="back-to-top" data-showlog="tid:133;cst:1;logInfo:back_to_top;" data-clklog="tid:138;cst:2;logInfo:back_to_top;" data-extralog="rid:;pos:;extra:;isBaiJiaHao:1;login:0;" data-rid="back_to_top" style="visibility: visible;"><div class="icon-text"><span>返回顶部</span></div><div class="icon-arrow"><span></span></div></div></div></div><script type="text/javascript">window.onload = function () {var contentContainer = document.getElementById('content-container');var bottomContainer = document.getElementById('bottom-container');var rightContainer = document.getElementById('right-container');var minContentHeight = window.innerHeight - bottomContainer.offsetHeight;if (contentContainer.offsetHeight < minContentHeight) {contentContainer.style.height = minContentHeight + 'px';bottomContainer.className += ' fixed';}if (rightContainer.children.length === 0) {rightContainer.style.width = parseInt(rightContainer.offsetWidth + 1, 10) + 'px';}};</script><script type="text/javascript" src="./ethtool 原理介绍和解决网卡丢包排查思路_files/jquery_0affbc1.js"></script><script type="text/javascript" src="./ethtool 原理介绍和解决网卡丢包排查思路_files/land_min_pack_8e22d87.js"></script><script type="text/javascript" src="./ethtool 原理介绍和解决网卡丢包排查思路_files/index_bd58962.js"></script><script>try {(function () {function getQueryValue(queryName) {var query = decodeURIComponent(window.location.search.substring(1));var vars = query.split('&');for (var i = 0; i < vars.length; i++) {var pair = vars[i].split('=');if (pair[0] == queryName) {return pair[1];}}return null;}function init_report() {$ && $.ajax({url: 'https://mbd.baidu.com/newspage/api/getusername',type: 'get',dataType: 'jsonp',jsonp: 'cb',success: function (res) {if (!(res && res.username)) {var currentHref = window.location.href;window.location.href = 'https://passport.baidu.com/v2/?login&tpl=mn&u=' + encodeURIComponent(currentHref);return;};if (bds && bds.qa && bds.qa.ShortCut && bds.qa.ShortCut.initRightBar) {var fb_options = {needImage: true,appid: 215939,productLine: 90509,'upload_file': true,requiredContent: false,issuePlaceholder: '请输入问题描述',contactPlaceholder: '请填写联系方式',isReport: true,hideHotQuestion: true};bds.qa.ShortCut.initRightBar(fb_options);var proData = {'referer': window.location.href,'extend_url': window.location.href,'extend_feedback_channel': '32598','resource_id': JSON.parse(getQueryValue('context')).nid,'daily_type': '67752','remark': 'bjh'};bds.qa.ShortCut._getProData(proData);}}});}function loadReportBar() {if (window.bds && window.bds.qa && window.bds.qa.ShortCut) {init_report();} else {loadScript('https://ufosdk.baidu.com/Public/feedback/js/dist/feedback_plugin_2.0.js',function () {init_report();}, {charset: 'utf-8',id: 'feedback_script'});}return false;}document.getElementById('feedback_report(215939)').onclick = loadReportBar;})();function loadScript(url, callback, opt) {var script = document.createElement('script');var opt = opt || {};script.type = 'text/javascript';if (opt.charset) {script.charset = opt.charset;}if (opt.id) {script.id = opt.id;}if (script.readyState) {script.onreadystatechange = function () {if (script.readyState === 'loaded' || script.readyState === 'complete') {script.onreadystatechange = null;callback();}};} else {script.onload = function () {callback();};}script.src = url;document.body.appendChild(script);}} catch (error) {}</script></body></html>